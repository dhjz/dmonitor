import{v as ge,g as ce,r as s,x as ve,y as he,z as ye,d as B,e as g,f as U,j as x,h as t,w as l,u as a,A as L,F as G,B as _e,E as be,C as xe,i as d,D as S,G as we,t as w,H as R,I as Ce,l as Ve,J as Y,K as ke,L as Re,M as Ee,N as Ie,q as Se,s as De,n as $e,p as Ke,O as Ne,P as Fe,Q as Be,R as Ue,S as Le,_ as Oe,T as Te,U as ze}from"./index-3441d032.js";import{s as C}from"./request-5c311338.js";const Me=i=>C({url:"/redis/listKey",method:"get",params:i}),He=i=>C({url:"/redis/getByKey",method:"get",params:i}),je=i=>C({url:"/redis/initRedis",method:"get",params:i}),qe=i=>C({url:"/redis/pingRedis",method:"get",params:i}),Ae=i=>C({url:"/redis/getRedisDbInfo",method:"get",params:i}),Je=i=>C({url:"/redis/changeRedisDb",method:"get",params:i});const Ge={class:"app-container"},Ye={style:{"vertical-align":"middle"}},Pe={key:0,class:"json-box"},Qe={class:"dialog-footer"},O="REDIS_LIST_KEY",We={__name:"index",setup(i){const{proxy:f}=ce(),T=s([]),c=s([]),D=s([]),r=s({}),P=s(!1),$=s(!1),v=s(!1),E=s(!1);s("");const I=s(""),V=s(null),h=s({}),z=s(window.innerHeight-200),{addForm:u,rules:Q}=ve(he({addForm:{host:"",port:6379,password:""},rules:{host:[{required:!0,message:"主机host不能为空",trigger:"blur"}],port:[{required:!0,message:"主机端口不能为空",trigger:"blur"}]}})),M=ye(()=>{if(!r.value.value)return"";try{return JSON.stringify(JSON.parse(r.value.value),null,2)}catch{return""}});function H(){const n=_e(O);n&&n.length&&(c.value=n)}function W(){H(),f.$modal.msgSuccess("刷新主机列表成功")}function X(n){f.$modal.confirm('是否确认删除名称为"'+n.host+'"的数据项?').then(()=>{let e=c.value.findIndex(p=>p.id==n.id);console.log("del",e),e>=0&&c.value.splice(e,1),Y(O,c.value)}).catch(()=>{})}function Z(){f.$refs.addFormRef.validate(n=>{n&&(c.value.push({...u.value,password:ke(u.value.password),id:Math.random().toString(32).slice(-5)}),Y(O,c.value),v.value=!1,u.value={host:"",post:6379,password:""})})}function ee(){E.value=!0,qe({...u.value}).then(n=>{n.data&&n.data.version?f.$modal.msgSuccess(`连接redis成功, 版本: ${n.data.version}, 模式: ${n.data.mode}`):f.$modal.msgError("连接redis失败")}).finally(()=>E.value=!1)}function te(n){je({...n,password:Re(n.password)}).then(e=>{e.code==200?(e.data&&(V.value=e.data.currDb+"",h.value=e.data.redisInfo||{}),le(),K()):(f.$modal.msgError("连接redis失败"),h.value={})})}function le(){Ae().then(n=>{let e=n.data||{};T.value=Object.keys(e).map(p=>({label:`${p} (${e[p]})`,value:p}))})}function K(){$.value=!0,Me({keyword:I.value||""}).then(n=>{let e=n.data||[];e.sort(),D.value=e.map(p=>({name:p})),$.value=!1})}function ae(){Je({index:V.value}).then(n=>{n.data&&j()})}function j(){K(),f.$modal.msgSuccess("刷新键名列表成功")}function oe(n){He({key:n.name}).then(e=>{e.data&&e.data.value?(e.data.expire=e.data.expire==0?"永久":Ee(e.data.expire),r.value=e.data):r.value={}})}function ne(){clearCacheAll().then(n=>{f.$modal.msgSuccess("清理全部缓存成功")})}return H(),(n,e)=>{const p=B("Collection"),m=Ie,k=Se,q=De,N=$e,y=Ke,se=B("Key"),_=Ne,de=ze,ie=Fe,re=B("Document"),b=Be,A=be,J=Ue,ue=Le,pe=xe,me=Oe,F=Te;return g(),U(G,null,[x("div",Ge,[t(A,{gutter:10},{default:l(()=>[t(y,{span:7},{default:l(()=>[t(N,{style:{height:"calc(100vh - 125px)"}},{header:l(()=>[t(p,{style:{width:"1em",height:"1em","vertical-align":"middle"}}),e[15]||(e[15]=d()),e[16]||(e[16]=x("span",{style:{"vertical-align":"middle"}},"主机列表",-1)),t(m,{style:{float:"right",padding:"3px 0","margin-left":"6px"},link:"",type:"primary",onClick:e[0]||(e[0]=o=>W())},{default:l(()=>e[13]||(e[13]=[d("刷新")])),_:1}),t(m,{style:{float:"right",padding:"3px 0","margin-left":"6px"},link:"",type:"primary",onClick:e[1]||(e[1]=o=>v.value=!0)},{default:l(()=>e[14]||(e[14]=[d("添加")])),_:1}),S(x("span",{style:{float:"right","margin-right":"50px","font-size":"12px",padding:"5px 0"}}," 当前连接信息: 版本: "+w(a(h).version||"")+", 模式: "+w(a(h).mode||""),513),[[we,a(h)&&a(h).version]])]),default:l(()=>[S((g(),R(q,{data:a(c),height:a(z),"highlight-current-row":"",style:{width:"100%"}},{default:l(()=>[t(k,{label:"序号",width:"60",type:"index"}),t(k,{label:"名称",align:"center",prop:"name","show-overflow-tooltip":!0},{default:l(({row:o})=>[d(w(o.host)+":"+w(o.port),1)]),_:1}),t(k,{label:"操作",width:"120",align:"center","class-name":"small-padding fixed-width"},{default:l(o=>[t(m,{link:"",type:"primary",onClick:fe=>te(o.row)},{default:l(()=>e[17]||(e[17]=[d("连接")])),_:2},1032,["onClick"]),t(m,{link:"",type:"primary",onClick:fe=>X(o.row)},{default:l(()=>e[18]||(e[18]=[d("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","height"])),[[F,a(P)]])]),_:1})]),_:1}),t(y,{span:7},{default:l(()=>[t(N,{style:{height:"calc(100vh - 125px)"}},{header:l(()=>[t(se,{style:{width:"1em",height:"1em","vertical-align":"middle"}}),e[20]||(e[20]=d()),x("span",Ye,"键名列表("+w(a(D).length)+"个)",1),t(m,{style:{float:"right",padding:"3px 0"},link:"",type:"primary",icon:"Refresh",onClick:j},{default:l(()=>e[19]||(e[19]=[d("刷新")])),_:1}),t(_,{style:{float:"right","margin-right":"10px",width:"170px"},size:"small",modelValue:a(I),"onUpdate:modelValue":e[2]||(e[2]=o=>L(I)?I.value=o:null),placeholder:"键名搜索, 回车确认",onKeyup:Ce(K,["enter"]),clearable:""},null,8,["modelValue"]),t(ie,{modelValue:a(V),"onUpdate:modelValue":e[3]||(e[3]=o=>L(V)?V.value=o:null),filterable:"",placeholder:"DB",size:"small",style:{float:"right","margin-right":"10px",width:"100px"},onChange:ae},{default:l(()=>[(g(!0),U(G,null,Ve(a(T),o=>(g(),R(de,{key:o.value,label:"DB_"+o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),default:l(()=>[S((g(),R(q,{data:a(D),height:a(z),"highlight-current-row":"",onRowClick:oe,style:{width:"100%"}},{default:l(()=>[t(k,{label:"序号",width:"60",type:"index"}),t(k,{label:"缓存键名",prop:"name",align:"center","show-overflow-tooltip":!0})]),_:1},8,["data","height"])),[[F,a($)]])]),_:1})]),_:1}),t(y,{span:10},{default:l(()=>[t(N,{bordered:!1,style:{height:"calc(100vh - 125px)"}},{header:l(()=>[t(re,{style:{width:"1em",height:"1em","vertical-align":"middle"}}),e[22]||(e[22]=d()),e[23]||(e[23]=x("span",{style:{"vertical-align":"middle"}},"缓存内容",-1)),t(m,{style:{float:"right",padding:"3px 0",display:"none"},link:"",type:"primary",icon:"Refresh",onClick:e[4]||(e[4]=o=>ne())},{default:l(()=>e[21]||(e[21]=[d("清理全部")])),_:1})]),default:l(()=>[t(J,{model:a(r)},{default:l(()=>[t(A,{gutter:32},{default:l(()=>[t(y,{offset:1,span:22},{default:l(()=>[t(b,{label:"缓存键名:",prop:"key"},{default:l(()=>[t(_,{modelValue:a(r).key,"onUpdate:modelValue":e[5]||(e[5]=o=>a(r).key=o),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),t(y,{offset:1,span:22},{default:l(()=>[t(b,{label:"缓存时间:",prop:"expire"},{default:l(()=>[t(_,{modelValue:a(r).expire,"onUpdate:modelValue":e[6]||(e[6]=o=>a(r).expire=o),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),t(y,{offset:1,span:22},{default:l(()=>[t(b,{label:"缓存内容:",prop:"value"},{default:l(()=>[a(M)?(g(),U("div",Pe,w(a(M)),1)):(g(),R(_,{key:1,modelValue:a(r).value,"onUpdate:modelValue":e[7]||(e[7]=o=>a(r).value=o),type:"textarea",autosize:{minRows:8,maxRows:15},readonly:""},null,8,["modelValue"]))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})]),t(pe,{modelValue:a(v),"onUpdate:modelValue":e[12]||(e[12]=o=>L(v)?v.value=o:null),title:"添加主机",width:"500"},{footer:l(()=>[x("div",Qe,[S((g(),R(m,{onClick:ee,style:{float:"left"},disabled:a(E)},{default:l(()=>e[24]||(e[24]=[d("测试连接")])),_:1},8,["disabled"])),[[F,a(E)]]),t(m,{type:"primary",onClick:Z},{default:l(()=>e[25]||(e[25]=[d("保存")])),_:1}),t(m,{onClick:e[11]||(e[11]=o=>v.value=!1)},{default:l(()=>e[26]||(e[26]=[d("取消")])),_:1})])]),default:l(()=>[t(J,{ref:"addFormRef",model:a(u),rules:a(Q)},{default:l(()=>[t(b,{label:"主机Host",prop:"host"},{default:l(()=>[t(_,{modelValue:a(u).host,"onUpdate:modelValue":e[8]||(e[8]=o=>a(u).host=o),modelModifiers:{trim:!0},autocomplete:"off",clearable:""},null,8,["modelValue"])]),_:1}),t(b,{label:"主机端口",prop:"port"},{default:l(()=>[t(ue,{modelValue:a(u).port,"onUpdate:modelValue":e[9]||(e[9]=o=>a(u).port=o),min:1,max:69999,clearable:"","controls-position":"right"},null,8,["modelValue"])]),_:1}),t(b,{label:"主机密码",prop:"password"},{default:l(()=>[t(_,{modelValue:a(u).password,"onUpdate:modelValue":e[10]||(e[10]=o=>a(u).password=o),modelModifiers:{trim:!0},autocomplete:"off",type:"password",clearable:"","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(me)],64)}}},et=ge(We,[["__scopeId","data-v-5d99879a"]]);export{et as default};
