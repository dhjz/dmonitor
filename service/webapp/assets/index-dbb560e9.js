import{n as _e,g as ve,r as d,p as ye,q as be,s as G,a as F,o as f,c as L,e as x,b as t,w as l,u as a,v as B,F as Y,x as we,E as xe,y as Ce,d as i,z as S,A as Ve,t as w,B as R,h as ke,C as P,D as Ie,G as Re,H as Ee,I as Se,l as $e,m as De,j as Ke,k as Ne,J as Fe,K as Le,L as Be,M as Oe,N as Ue,_ as ze,O as Me,P as Te,Q as He,R as je}from"./index-618cd956.js";import{s as C}from"./request-373b0207.js";const qe=()=>C({url:"/redis/listKey",method:"get"}),Ae=s=>C({url:"/redis/getByKey",method:"get",params:s}),Je=s=>C({url:"/redis/initRedis",method:"get",params:s}),Ge=s=>C({url:"/redis/pingRedis",method:"get",params:s}),Ye=s=>C({url:"/redis/getRedisDbInfo",method:"get",params:s}),Pe=s=>C({url:"/redis/changeRedisDb",method:"get",params:s});const Q=s=>(Te("data-v-5717e233"),s=s(),He(),s),Qe={class:"app-container"},We=Q(()=>x("span",{style:{"vertical-align":"middle"}},"主机列表",-1)),Xe={style:{"vertical-align":"middle"}},Ze=Q(()=>x("span",{style:{"vertical-align":"middle"}},"缓存内容",-1)),et={key:0,class:"json-box"},tt={class:"dialog-footer"},O="REDIS_LIST_KEY",lt={__name:"index",setup(s){const{proxy:c}=ve(),U=d([]),g=d([]),$=d([]),r=d({}),W=d(!1),D=d(!1),h=d(!1),E=d(!1);d("");const V=d(""),k=d(null),_=d({}),z=d(window.innerHeight-200),{addForm:u,rules:X}=ye(be({addForm:{host:"",port:6379,password:""},rules:{host:[{required:!0,message:"主机host不能为空",trigger:"blur"}],port:[{required:!0,message:"主机端口不能为空",trigger:"blur"}]}})),Z=G(()=>$.value.filter(n=>!V.value||n.name.toLowerCase().includes(V.value.toLowerCase()))),M=G(()=>{if(!r.value.value)return"";try{return JSON.stringify(JSON.parse(r.value.value),null,2)}catch{return""}});function T(){const n=we(O);n&&n.length&&(g.value=n)}function ee(){T(),c.$modal.msgSuccess("刷新主机列表成功")}function te(n){c.$modal.confirm('是否确认删除名称为"'+n.host+'"的数据项?').then(()=>{let e=g.value.findIndex(p=>p.id==n.id);console.log("del",e),e>=0&&g.value.splice(e,1),P(O,g.value)}).catch(()=>{})}function le(){c.$refs.addFormRef.validate(n=>{n&&(g.value.push({...u.value,password:Ie(u.value.password),id:Math.random().toString(32).slice(-5)}),P(O,g.value),h.value=!1,u.value={host:"",post:6379,password:""})})}function ae(){E.value=!0,Ge({...u.value}).then(n=>{n.data&&n.data.version?c.$modal.msgSuccess(`连接redis成功, 版本: ${n.data.version}, 模式: ${n.data.mode}`):c.$modal.msgError("连接redis失败")}).finally(()=>E.value=!1)}function oe(n){Je({...n,password:Re(n.password)}).then(e=>{e.code==200?(e.data&&(k.value=e.data.currDb+"",_.value=e.data.redisInfo||{}),ne(),H()):(c.$modal.msgError("连接redis失败"),_.value={})})}function ne(){Ye().then(n=>{let e=n.data||{};U.value=Object.keys(e).map(p=>({label:`${p} (${e[p]})`,value:p}))})}function H(){D.value=!0,qe().then(n=>{let e=n.data||[];e.sort(),$.value=e.map(p=>({name:p})),D.value=!1})}function se(){Pe({index:k.value}).then(n=>{n.data&&j()})}function j(){H(),c.$modal.msgSuccess("刷新键名列表成功")}function de(n){Ae({key:n.name}).then(e=>{e.data&&e.data.value?(e.data.expire=e.data.expire==0?"永久":Ee(e.data.expire),r.value=e.data):r.value={}})}function ie(){clearCacheAll().then(n=>{c.$modal.msgSuccess("清理全部缓存成功")})}return T(),(n,e)=>{const p=F("Collection"),m=Se,I=$e,q=De,K=Ke,v=Ne,re=F("Key"),y=Fe,ue=je,pe=Le,me=F("Document"),b=Be,A=xe,J=Oe,ce=Ue,fe=Ce,ge=ze,N=Me;return f(),L(Y,null,[x("div",Qe,[t(A,{gutter:10},{default:l(()=>[t(v,{span:7},{default:l(()=>[t(K,{style:{height:"calc(100vh - 125px)"}},{header:l(()=>[t(p,{style:{width:"1em",height:"1em","vertical-align":"middle"}}),i(),We,t(m,{style:{float:"right",padding:"3px 0","margin-left":"6px"},link:"",type:"primary",onClick:e[0]||(e[0]=o=>ee())},{default:l(()=>[i("刷新")]),_:1}),t(m,{style:{float:"right",padding:"3px 0","margin-left":"6px"},link:"",type:"primary",onClick:e[1]||(e[1]=o=>h.value=!0)},{default:l(()=>[i("添加")]),_:1}),S(x("span",{style:{float:"right","margin-right":"50px","font-size":"12px",padding:"5px 0"}}," 当前连接信息: 版本: "+w(a(_).version||"")+", 模式: "+w(a(_).mode||""),513),[[Ve,a(_)&&a(_).version]])]),default:l(()=>[S((f(),R(q,{data:a(g),height:a(z),"highlight-current-row":"",style:{width:"100%"}},{default:l(()=>[t(I,{label:"序号",width:"60",type:"index"}),t(I,{label:"名称",align:"center",prop:"name","show-overflow-tooltip":!0},{default:l(({row:o})=>[i(w(o.host)+":"+w(o.port),1)]),_:1}),t(I,{label:"操作",width:"120",align:"center","class-name":"small-padding fixed-width"},{default:l(o=>[t(m,{link:"",type:"primary",onClick:he=>oe(o.row)},{default:l(()=>[i("连接")]),_:2},1032,["onClick"]),t(m,{link:"",type:"primary",onClick:he=>te(o.row)},{default:l(()=>[i("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","height"])),[[N,a(W)]])]),_:1})]),_:1}),t(v,{span:7},{default:l(()=>[t(K,{style:{height:"calc(100vh - 125px)"}},{header:l(()=>[t(re,{style:{width:"1em",height:"1em","vertical-align":"middle"}}),i(),x("span",Xe,"键名列表(共"+w(a($).length)+"个)",1),t(m,{style:{float:"right",padding:"3px 0"},link:"",type:"primary",icon:"Refresh",onClick:e[2]||(e[2]=o=>j())},{default:l(()=>[i("刷新")]),_:1}),t(y,{style:{float:"right","margin-right":"10px",width:"170px"},size:"small",modelValue:a(V),"onUpdate:modelValue":e[3]||(e[3]=o=>B(V)?V.value=o:null),placeholder:"键名搜索, 回车确认",clearable:""},null,8,["modelValue"]),t(pe,{modelValue:a(k),"onUpdate:modelValue":e[4]||(e[4]=o=>B(k)?k.value=o:null),filterable:"",placeholder:"DB",size:"small",style:{float:"right","margin-right":"10px",width:"100px"},onChange:se},{default:l(()=>[(f(!0),L(Y,null,ke(a(U),o=>(f(),R(ue,{key:o.value,label:"DB_"+o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),default:l(()=>[S((f(),R(q,{data:a(Z),height:a(z),"highlight-current-row":"",onRowClick:de,style:{width:"100%"}},{default:l(()=>[t(I,{label:"序号",width:"60",type:"index"}),t(I,{label:"缓存键名",prop:"name",align:"center","show-overflow-tooltip":!0})]),_:1},8,["data","height"])),[[N,a(D)]])]),_:1})]),_:1}),t(v,{span:10},{default:l(()=>[t(K,{bordered:!1,style:{height:"calc(100vh - 125px)"}},{header:l(()=>[t(me,{style:{width:"1em",height:"1em","vertical-align":"middle"}}),i(),Ze,t(m,{style:{float:"right",padding:"3px 0",display:"none"},link:"",type:"primary",icon:"Refresh",onClick:e[5]||(e[5]=o=>ie())},{default:l(()=>[i("清理全部")]),_:1})]),default:l(()=>[t(J,{model:a(r)},{default:l(()=>[t(A,{gutter:32},{default:l(()=>[t(v,{offset:1,span:22},{default:l(()=>[t(b,{label:"缓存键名:",prop:"key"},{default:l(()=>[t(y,{modelValue:a(r).key,"onUpdate:modelValue":e[6]||(e[6]=o=>a(r).key=o),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{offset:1,span:22},{default:l(()=>[t(b,{label:"缓存时间:",prop:"expire"},{default:l(()=>[t(y,{modelValue:a(r).expire,"onUpdate:modelValue":e[7]||(e[7]=o=>a(r).expire=o),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{offset:1,span:22},{default:l(()=>[t(b,{label:"缓存内容:",prop:"value"},{default:l(()=>[a(M)?(f(),L("div",et,w(a(M)),1)):(f(),R(y,{key:1,modelValue:a(r).value,"onUpdate:modelValue":e[8]||(e[8]=o=>a(r).value=o),type:"textarea",autosize:{minRows:8,maxRows:15},readonly:""},null,8,["modelValue"]))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})]),t(fe,{modelValue:a(h),"onUpdate:modelValue":e[13]||(e[13]=o=>B(h)?h.value=o:null),title:"添加主机",width:"500"},{footer:l(()=>[x("div",tt,[S((f(),R(m,{onClick:ae,style:{float:"left"},disabled:a(E)},{default:l(()=>[i("测试连接")]),_:1},8,["disabled"])),[[N,a(E)]]),t(m,{type:"primary",onClick:le},{default:l(()=>[i("保存")]),_:1}),t(m,{onClick:e[12]||(e[12]=o=>h.value=!1)},{default:l(()=>[i("取消")]),_:1})])]),default:l(()=>[t(J,{ref:"addFormRef",model:a(u),rules:a(X)},{default:l(()=>[t(b,{label:"主机Host",prop:"host"},{default:l(()=>[t(y,{modelValue:a(u).host,"onUpdate:modelValue":e[9]||(e[9]=o=>a(u).host=o),modelModifiers:{trim:!0},autocomplete:"off",clearable:""},null,8,["modelValue"])]),_:1}),t(b,{label:"主机端口",prop:"port"},{default:l(()=>[t(ce,{modelValue:a(u).port,"onUpdate:modelValue":e[10]||(e[10]=o=>a(u).port=o),min:1,max:69999,clearable:"","controls-position":"right"},null,8,["modelValue"])]),_:1}),t(b,{label:"主机密码",prop:"password"},{default:l(()=>[t(y,{modelValue:a(u).password,"onUpdate:modelValue":e[11]||(e[11]=o=>a(u).password=o),modelModifiers:{trim:!0},autocomplete:"off",type:"password",clearable:"","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(ge)],64)}}},nt=_e(lt,[["__scopeId","data-v-5717e233"]]);export{nt as default};
