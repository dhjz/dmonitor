import{v as ge,g as he,r as d,x as _e,y as ve,z as ye,d as B,e as f,f as U,j as x,h as t,w as l,u as a,A as L,F as G,B as be,E as we,C as xe,i,D as E,G as Ce,t as w,H as I,I as Ve,l as ke,J as Y,K as Ie,L as Re,M as Se,N as Ee,q as De,s as $e,n as Ke,p as Ne,O as Fe,P as Be,Q as Ue,R as Le,S as Oe,_ as Te,T as ze,U as Me,V as He,W as je}from"./index-18099f67.js";import{s as C}from"./request-ecb1507f.js";const qe=s=>C({url:"/redis/listKey",method:"get",params:s}),Ae=s=>C({url:"/redis/getByKey",method:"get",params:s}),Je=s=>C({url:"/redis/initRedis",method:"get",params:s}),Ge=s=>C({url:"/redis/pingRedis",method:"get",params:s}),Ye=s=>C({url:"/redis/getRedisDbInfo",method:"get",params:s}),Pe=s=>C({url:"/redis/changeRedisDb",method:"get",params:s});const P=s=>(Me("data-v-5d99879a"),s=s(),He(),s),Qe={class:"app-container"},We=P(()=>x("span",{style:{"vertical-align":"middle"}},"主机列表",-1)),Xe={style:{"vertical-align":"middle"}},Ze=P(()=>x("span",{style:{"vertical-align":"middle"}},"缓存内容",-1)),et={key:0,class:"json-box"},tt={class:"dialog-footer"},O="REDIS_LIST_KEY",lt={__name:"index",setup(s){const{proxy:m}=he(),T=d([]),g=d([]),D=d([]),r=d({}),Q=d(!1),$=d(!1),h=d(!1),R=d(!1);d("");const S=d(""),V=d(null),_=d({}),z=d(window.innerHeight-200),{addForm:u,rules:W}=_e(ve({addForm:{host:"",port:6379,password:""},rules:{host:[{required:!0,message:"主机host不能为空",trigger:"blur"}],port:[{required:!0,message:"主机端口不能为空",trigger:"blur"}]}})),M=ye(()=>{if(!r.value.value)return"";try{return JSON.stringify(JSON.parse(r.value.value),null,2)}catch{return""}});function H(){const n=be(O);n&&n.length&&(g.value=n)}function X(){H(),m.$modal.msgSuccess("刷新主机列表成功")}function Z(n){m.$modal.confirm('是否确认删除名称为"'+n.host+'"的数据项?').then(()=>{let e=g.value.findIndex(p=>p.id==n.id);console.log("del",e),e>=0&&g.value.splice(e,1),Y(O,g.value)}).catch(()=>{})}function ee(){m.$refs.addFormRef.validate(n=>{n&&(g.value.push({...u.value,password:Ie(u.value.password),id:Math.random().toString(32).slice(-5)}),Y(O,g.value),h.value=!1,u.value={host:"",post:6379,password:""})})}function te(){R.value=!0,Ge({...u.value}).then(n=>{n.data&&n.data.version?m.$modal.msgSuccess(`连接redis成功, 版本: ${n.data.version}, 模式: ${n.data.mode}`):m.$modal.msgError("连接redis失败")}).finally(()=>R.value=!1)}function le(n){Je({...n,password:Re(n.password)}).then(e=>{e.code==200?(e.data&&(V.value=e.data.currDb+"",_.value=e.data.redisInfo||{}),ae(),K()):(m.$modal.msgError("连接redis失败"),_.value={})})}function ae(){Ye().then(n=>{let e=n.data||{};T.value=Object.keys(e).map(p=>({label:`${p} (${e[p]})`,value:p}))})}function K(){$.value=!0,qe({keyword:S.value||""}).then(n=>{let e=n.data||[];e.sort(),D.value=e.map(p=>({name:p})),$.value=!1})}function oe(){Pe({index:V.value}).then(n=>{n.data&&j()})}function j(){K(),m.$modal.msgSuccess("刷新键名列表成功")}function ne(n){Ae({key:n.name}).then(e=>{e.data&&e.data.value?(e.data.expire=e.data.expire==0?"永久":Se(e.data.expire),r.value=e.data):r.value={}})}function se(){clearCacheAll().then(n=>{m.$modal.msgSuccess("清理全部缓存成功")})}return H(),(n,e)=>{const p=B("Collection"),c=Ee,k=De,q=$e,N=Ke,v=Ne,de=B("Key"),y=Fe,ie=je,re=Be,ue=B("Document"),b=Ue,A=we,J=Le,pe=Oe,ce=xe,me=Te,F=ze;return f(),U(G,null,[x("div",Qe,[t(A,{gutter:10},{default:l(()=>[t(v,{span:7},{default:l(()=>[t(N,{style:{height:"calc(100vh - 125px)"}},{header:l(()=>[t(p,{style:{width:"1em",height:"1em","vertical-align":"middle"}}),i(),We,t(c,{style:{float:"right",padding:"3px 0","margin-left":"6px"},link:"",type:"primary",onClick:e[0]||(e[0]=o=>X())},{default:l(()=>[i("刷新")]),_:1}),t(c,{style:{float:"right",padding:"3px 0","margin-left":"6px"},link:"",type:"primary",onClick:e[1]||(e[1]=o=>h.value=!0)},{default:l(()=>[i("添加")]),_:1}),E(x("span",{style:{float:"right","margin-right":"50px","font-size":"12px",padding:"5px 0"}}," 当前连接信息: 版本: "+w(a(_).version||"")+", 模式: "+w(a(_).mode||""),513),[[Ce,a(_)&&a(_).version]])]),default:l(()=>[E((f(),I(q,{data:a(g),height:a(z),"highlight-current-row":"",style:{width:"100%"}},{default:l(()=>[t(k,{label:"序号",width:"60",type:"index"}),t(k,{label:"名称",align:"center",prop:"name","show-overflow-tooltip":!0},{default:l(({row:o})=>[i(w(o.host)+":"+w(o.port),1)]),_:1}),t(k,{label:"操作",width:"120",align:"center","class-name":"small-padding fixed-width"},{default:l(o=>[t(c,{link:"",type:"primary",onClick:fe=>le(o.row)},{default:l(()=>[i("连接")]),_:2},1032,["onClick"]),t(c,{link:"",type:"primary",onClick:fe=>Z(o.row)},{default:l(()=>[i("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","height"])),[[F,a(Q)]])]),_:1})]),_:1}),t(v,{span:7},{default:l(()=>[t(N,{style:{height:"calc(100vh - 125px)"}},{header:l(()=>[t(de,{style:{width:"1em",height:"1em","vertical-align":"middle"}}),i(),x("span",Xe,"键名列表("+w(a(D).length)+"个)",1),t(c,{style:{float:"right",padding:"3px 0"},link:"",type:"primary",icon:"Refresh",onClick:j},{default:l(()=>[i("刷新")]),_:1}),t(y,{style:{float:"right","margin-right":"10px",width:"170px"},size:"small",modelValue:a(S),"onUpdate:modelValue":e[2]||(e[2]=o=>L(S)?S.value=o:null),placeholder:"键名搜索, 回车确认",onKeyup:Ve(K,["enter"]),clearable:""},null,8,["modelValue","onKeyup"]),t(re,{modelValue:a(V),"onUpdate:modelValue":e[3]||(e[3]=o=>L(V)?V.value=o:null),filterable:"",placeholder:"DB",size:"small",style:{float:"right","margin-right":"10px",width:"100px"},onChange:oe},{default:l(()=>[(f(!0),U(G,null,ke(a(T),o=>(f(),I(ie,{key:o.value,label:"DB_"+o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),default:l(()=>[E((f(),I(q,{data:a(D),height:a(z),"highlight-current-row":"",onRowClick:ne,style:{width:"100%"}},{default:l(()=>[t(k,{label:"序号",width:"60",type:"index"}),t(k,{label:"缓存键名",prop:"name",align:"center","show-overflow-tooltip":!0})]),_:1},8,["data","height"])),[[F,a($)]])]),_:1})]),_:1}),t(v,{span:10},{default:l(()=>[t(N,{bordered:!1,style:{height:"calc(100vh - 125px)"}},{header:l(()=>[t(ue,{style:{width:"1em",height:"1em","vertical-align":"middle"}}),i(),Ze,t(c,{style:{float:"right",padding:"3px 0",display:"none"},link:"",type:"primary",icon:"Refresh",onClick:e[4]||(e[4]=o=>se())},{default:l(()=>[i("清理全部")]),_:1})]),default:l(()=>[t(J,{model:a(r)},{default:l(()=>[t(A,{gutter:32},{default:l(()=>[t(v,{offset:1,span:22},{default:l(()=>[t(b,{label:"缓存键名:",prop:"key"},{default:l(()=>[t(y,{modelValue:a(r).key,"onUpdate:modelValue":e[5]||(e[5]=o=>a(r).key=o),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{offset:1,span:22},{default:l(()=>[t(b,{label:"缓存时间:",prop:"expire"},{default:l(()=>[t(y,{modelValue:a(r).expire,"onUpdate:modelValue":e[6]||(e[6]=o=>a(r).expire=o),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{offset:1,span:22},{default:l(()=>[t(b,{label:"缓存内容:",prop:"value"},{default:l(()=>[a(M)?(f(),U("div",et,w(a(M)),1)):(f(),I(y,{key:1,modelValue:a(r).value,"onUpdate:modelValue":e[7]||(e[7]=o=>a(r).value=o),type:"textarea",autosize:{minRows:8,maxRows:15},readonly:""},null,8,["modelValue"]))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})]),t(ce,{modelValue:a(h),"onUpdate:modelValue":e[12]||(e[12]=o=>L(h)?h.value=o:null),title:"添加主机",width:"500"},{footer:l(()=>[x("div",tt,[E((f(),I(c,{onClick:te,style:{float:"left"},disabled:a(R)},{default:l(()=>[i("测试连接")]),_:1},8,["disabled"])),[[F,a(R)]]),t(c,{type:"primary",onClick:ee},{default:l(()=>[i("保存")]),_:1}),t(c,{onClick:e[11]||(e[11]=o=>h.value=!1)},{default:l(()=>[i("取消")]),_:1})])]),default:l(()=>[t(J,{ref:"addFormRef",model:a(u),rules:a(W)},{default:l(()=>[t(b,{label:"主机Host",prop:"host"},{default:l(()=>[t(y,{modelValue:a(u).host,"onUpdate:modelValue":e[8]||(e[8]=o=>a(u).host=o),modelModifiers:{trim:!0},autocomplete:"off",clearable:""},null,8,["modelValue"])]),_:1}),t(b,{label:"主机端口",prop:"port"},{default:l(()=>[t(pe,{modelValue:a(u).port,"onUpdate:modelValue":e[9]||(e[9]=o=>a(u).port=o),min:1,max:69999,clearable:"","controls-position":"right"},null,8,["modelValue"])]),_:1}),t(b,{label:"主机密码",prop:"password"},{default:l(()=>[t(y,{modelValue:a(u).password,"onUpdate:modelValue":e[10]||(e[10]=o=>a(u).password=o),modelModifiers:{trim:!0},autocomplete:"off",type:"password",clearable:"","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(me)],64)}}},nt=ge(lt,[["__scopeId","data-v-5d99879a"]]);export{nt as default};
